<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BaseFarm Tracker - Airdrop Checklist</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        :root {
            --primary-color: #0052ff;
            --success-color: #28a745;
            --danger-color: #e53e3e;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --today-color: #0052ff;
            
            --background-color: #f0f4f8;
            --card-background: #ffffff;
            --card-secondary-bg: #f8fafc;
            --text-color: #1a202c;
            --subtle-text-color: #6b7280;
            --border-color: #e2e8f0;
            --hover-color: #eff6ff;
        }

        body.dark {
            --background-color: #111827;
            --card-background: #1f2937;
            --card-secondary-bg: #374151;
            --text-color: #f9fafb;
            --subtle-text-color: #9ca3af;
            --border-color: #4b5563;
            --hover-color: #374151;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 1rem;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            min-height: 100vh;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        #root {
            width: 100%;
            display: flex;
            justify-content: center;
        }
        .app-container {
            width: 100%;
            max-width: 800px;
            background-color: var(--card-background);
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
            padding: 2rem;
            box-sizing: border-box;
            transition: background-color 0.3s ease;
        }
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
            transition: border-color 0.3s ease;
        }
        .header-left {
             display: flex;
            align-items: center;
            gap: 1rem;
        }
        .app-header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin: 0;
        }
        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .icon-button {
            background: none;
            border: 1px solid var(--border-color);
            color: var(--subtle-text-color);
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s, color 0.2s;
        }
        .icon-button:hover {
            background-color: var(--card-secondary-bg);
            color: var(--text-color);
        }
        .connectButton {
            background-color: var(--primary-color); color: white; border: none; padding: 0.75rem 1.25rem;
            border-radius: 8px; cursor: pointer; font-size: 0.9rem; font-weight: 600;
            transition: background-color 0.3s ease;
        }
        .connectButton:hover { background-color: #0045d1; }
        
        .profile-button {
            position: relative;
        }
        .profile-image {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid var(--border-color);
        }
        .profile-dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            background-color: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 0.5rem;
            width: 200px;
            z-index: 10;
            display: none;
        }
        .profile-button:hover .profile-dropdown {
            display: block;
        }
        .profile-dropdown .info { padding: 0.5rem; border-bottom: 1px solid var(--border-color); }
        .profile-dropdown .username { font-weight: 600; }
        .profile-dropdown .address { font-size: 0.8rem; color: var(--subtle-text-color); word-break: break-all; }
        .profile-dropdown button {
            background: none; border: none; color: var(--danger-color);
            width: 100%; text-align: left; padding: 0.75rem;
            cursor: pointer; font-weight: 500; border-radius: 4px;
        }
        .profile-dropdown button:hover { background-color: var(--hover-color); }


        .controls-section { display: flex; gap: 1rem; margin-bottom: 2rem; align-items: stretch; flex-wrap: wrap; }
        .project-form { display: flex; gap: 0.5rem; flex-grow: 1; min-width: 300px; }
        .project-form input {
            flex-grow: 1; padding: 0.75rem 1rem; border: 1px solid var(--border-color);
            border-radius: 8px; font-size: 1rem; background-color: var(--card-background);
            color: var(--text-color); transition: border-color 0.3s, background-color 0.3s;
        }
        .project-form button {
            background-color: var(--primary-color); color: white; border: none;
            padding: 0 1.5rem; border-radius: 8px; font-weight: 600; cursor: pointer;
            transition: background-color 0.3s ease; display: flex; align-items: center; gap: 0.5rem;
        }
        .project-form button:hover { background-color: #0045d1; }
        .sort-control select {
            height: 100%; padding: 0.75rem 1rem; border-radius: 8px; border: 1px solid var(--border-color);
            background-color: var(--card-background); color: var(--text-color); font-size: 0.9rem;
            font-family: 'Inter', sans-serif;
        }

        .project-card {
            background-color: var(--card-secondary-bg); border: 1px solid var(--border-color);
            border-radius: 12px; margin-bottom: 1.5rem;
            transition: background-color 0.3s, border-color 0.3s;
        }
        .project-card-main { padding: 1.5rem; }
        .project-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
        .project-header h2 { margin: 0; font-size: 1.2rem; }
        .action-button { background: none; border: none; cursor: pointer; color: var(--subtle-text-color); transition: color 0.2s; padding: 0.25rem; }
        .action-button.delete:hover { color: var(--danger-color); }
        .action-button.edit:hover { color: var(--primary-color); }
        
        .progress-info { margin-bottom: 1rem; }
        .progress-text { font-size: 0.8rem; color: var(--subtle-text-color); margin-bottom: 0.25rem; }
        .progress-bar-container { width: 100%; background-color: var(--border-color); border-radius: 99px; height: 8px; overflow: hidden; transition: background-color 0.3s ease; }
        .progress-bar { height: 100%; background-color: var(--primary-color); border-radius: 99px; transition: width 0.5s ease; }
        
        .details-toggle {
            background: none; border: none; width: 100%; text-align: left; padding: 0.5rem 1.5rem;
            border-top: 1px solid var(--border-color); color: var(--subtle-text-color); cursor: pointer;
            display: flex; align-items: center; gap: 0.25rem; font-weight: 500;
        }
        .details-toggle svg { transition: transform 0.3s ease; }
        .details-toggle.open svg { transform: rotate(90deg); }
        .project-details {
            padding: 0 1.5rem;
            overflow: hidden; max-height: 0; transition: all 0.5s ease-in-out;
        }
        .project-details.open { max-height: 1000px; padding: 0 1.5rem 1.5rem 1.5rem; }
        .details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .details-grid label { font-size: 0.8rem; font-weight: 500; color: var(--subtle-text-color); margin-bottom: 0.25rem; display: block; }
        .details-grid input, .details-grid textarea {
            width: 100%; padding: 0.5rem 0.75rem; border: 1px solid var(--border-color); border-radius: 6px;
            font-size: 0.9rem; background-color: var(--card-background); color: var(--text-color);
            font-family: 'Inter', sans-serif; box-sizing: border-box;
        }
        .details-grid textarea { min-height: 80px; resize: vertical; }

        .task-list { list-style: none; padding: 0; margin: 0; }
        .task-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 0.5rem; flex-wrap: wrap; border-radius: 8px; transition: background-color 0.2s ease;}
        .task-item:hover { background-color: var(--hover-color); }
        .task-item-main { display: flex; align-items: center; flex-grow: 1; gap: 0.75rem; min-width: 200px; }
        .task-item input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; flex-shrink: 0; }
        .task-item label { flex-grow: 1; cursor: pointer; }
        .task-item label.completed { text-decoration: line-through; color: var(--subtle-text-color); }
        .task-item-actions { display: flex; align-items: center; gap: 0.5rem; }
        
        .priority-tag { font-size: 0.75rem; font-weight: 600; padding: 0.15rem 0.5rem; border-radius: 99px; text-transform: uppercase; }
        .priority-tag.high { background-color: #fed7d7; color: var(--danger-color); } body.dark .priority-tag.high { background-color: #5c1b1b; color: #fca5a5; }
        .priority-tag.medium { background-color: #feebc8; color: #b45309; } body.dark .priority-tag.medium { background-color: #78350f; color: #fcd34d; }
        .priority-tag.low { background-color: #bee3f8; color: #2b6cb0; } body.dark .priority-tag.low { background-color: #1e40af; color: #93c5fd; }

        .task-due-date { font-size: 0.8rem; font-weight: 500; padding: 0.2rem 0.5rem; border-radius: 4px; background-color: var(--border-color); color: var(--subtle-text-color); flex-shrink: 0; transition: background-color 0.3s, color 0.3s; }
        .task-due-date.overdue { background-color: #fed7d7; color: var(--danger-color); } body.dark .task-due-date.overdue { background-color: #5c1b1b; color: #fca5a5; }
        .task-due-date.today { background-color: #bee3f8; color: var(--today-color); } body.dark .task-due-date.today { background-color: #1e40af; color: #93c5fd; }
        
        .task-form, .edit-task-form { display: flex; gap: 0.5rem; margin-top: 1rem; flex-wrap: wrap; }
        .task-form input, .task-form select, .edit-task-form input { padding: 0.5rem 0.75rem; border: 1px solid var(--border-color); border-radius: 6px; font-size: 0.9rem; background-color: var(--card-background); color: var(--text-color); font-family: 'Inter', sans-serif; transition: border-color 0.3s, background-color 0.3s; }
        .task-form input[type="text"], .edit-task-form input[type="text"] { flex-grow: 1; min-width: 150px; }
        .task-form button, .edit-task-form button { background-color: var(--success-color); color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; font-weight: 500; cursor: pointer; transition: background-color 0.3s ease; display: flex; align-items: center; gap: 0.25rem; }
        .task-form button:hover, .edit-task-form button:hover { background-color: #218838; }

        .completed-section-toggle { background: none; border: none; color: var(--subtle-text-color); cursor: pointer; font-weight: 500; padding: 0.5rem; display: flex; align-items: center; gap: 0.25rem; margin-top: 1rem; border-radius: 6px; transition: background-color 0.2s; }
        .completed-section-toggle:hover { background-color: var(--hover-color); }
        .completed-section-toggle svg { transition: transform 0.3s ease; }
        .completed-section-toggle.open svg { transform: rotate(90deg); }
        .completed-list { overflow: hidden; max-height: 0; transition: max-height 0.5s ease-in-out; }
        .completed-list.open { max-height: 1000px; }

        .notification { padding: 1rem; margin-bottom: 1.5rem; border-radius: 8px; font-weight: 500; text-align: center; }
        .notification.success { background-color: #e9f7ec; color: #155724; }
        .notification.error { background-color: #f8d7da; color: #721c24; }
        
        .modal-backdrop { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 100; }
        .modal-content { background-color: var(--card-background); padding: 2rem; border-radius: 16px; width: 90%; max-width: 400px; position: relative; }
        .modal-close { position: absolute; top: 1rem; right: 1rem; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--subtle-text-color); }
        .modal-content h2 { margin-top: 0; }
        .wallet-options { display: flex; flex-direction: column; gap: 1rem; }
        .wallet-button {
            display: flex; align-items: center; gap: 1rem; padding: 1rem; border: 1px solid var(--border-color);
            border-radius: 8px; cursor: pointer; transition: background-color 0.2s; font-size: 1rem; font-weight: 600;
            background-color: var(--card-secondary-bg); color: var(--text-color); width: 100%;
        }
        .wallet-button:hover { background-color: var(--hover-color); }
        .wallet-button img, .wallet-button svg { width: 24px; height: 24px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        function App() {
            const [userAddress, setUserAddress] = React.useState(null);
            const [farcasterUser, setFarcasterUser] = React.useState(null);
            const [notification, setNotification] = React.useState({ message: '', type: '' });
            const [theme, setTheme] = React.useState(() => localStorage.getItem('theme') || 'light');
            const [isModalOpen, setIsModalOpen] = React.useState(false);

            React.useEffect(() => {
                document.body.className = theme;
                localStorage.setItem('theme', theme);
            }, [theme]);
            
            // Farcaster listener
            React.useEffect(() => {
                const handleFarcasterResponse = (event) => {
                    if (event.data.type === 'farcasterUserResponse') {
                        const { pfp, displayName, verifications } = event.data.user;
                        if (verifications && verifications.length > 0) {
                            setUserAddress(verifications[0]);
                            setFarcasterUser({ pfp, displayName });
                            setIsModalOpen(false);
                            showNotification(`Welcome, ${displayName}!`, "success");
                        } else {
                            showNotification("Farcaster user has no verified address.", "error");
                        }
                    }
                };

                window.addEventListener('message', handleFarcasterResponse);
                return () => window.removeEventListener('message', handleFarcasterResponse);
            }, []);

            const toggleTheme = () => setTheme(prevTheme => (prevTheme === 'light' ? 'dark' : 'light'));

            const showNotification = (message, type = 'info') => {
                setNotification({ message, type });
                setTimeout(() => setNotification({ message: '', type: '' }), 4000);
            };

            const handleConnect = async (provider) => {
                if (!provider) {
                    return showNotification("Selected wallet provider is not available.", "error");
                }
                try {
                    const ethersProvider = new ethers.providers.Web3Provider(provider, "any");
                    await ethersProvider.send("eth_requestAccounts", []);
                    const signer = ethersProvider.getSigner();
                    const address = await signer.getAddress();
                    setUserAddress(address);
                    setFarcasterUser(null);
                    setIsModalOpen(false);
                    showNotification("Wallet Connected! Your tracker is unlocked.", "success");
                } catch (err) {
                    console.error(err);
                    showNotification("Failed to connect wallet.", "error");
                }
            };
            
            const handleFarcasterConnect = () => {
                window.parent.postMessage({ type: 'farcasterUserRequest' }, '*');
            };

            const disconnectWallet = async () => {
                if (window.ethereum && window.ethereum.request) {
                    try {
                        await window.ethereum.request({ method: 'wallet_revokePermissions', params: [{ eth_accounts: {} }] });
                    } catch (err) { console.error("Could not revoke permissions:", err); }
                }
                setUserAddress(null);
                setFarcasterUser(null);
                showNotification("Disconnected.", "success");
            };
            
            return (
                <div className="app-container">
                    <div className="app-header">
                        <div className="header-left"><h1>BaseFarm Tracker</h1></div>
                        <div className="header-actions">
                            {userAddress ? (
                                farcasterUser ? (
                                    <div className="profile-button">
                                        <img src={farcasterUser.pfp} alt="Farcaster PFP" className="profile-image" />
                                        <div className="profile-dropdown">
                                            <div className="info">
                                                <div className="username">{farcasterUser.displayName}</div>
                                                <div className="address">{`${userAddress.substring(0, 6)}...${userAddress.substring(userAddress.length - 4)}`}</div>
                                            </div>
                                            <button onClick={disconnectWallet}>Disconnect</button>
                                        </div>
                                    </div>
                                ) : (
                                    <button className="connectButton disconnect" onClick={disconnectWallet}>
                                        Disconnect
                                    </button>
                                )
                            ) : (
                                <button className="connectButton" onClick={() => setIsModalOpen(true)}>
                                    Connect Wallet
                                </button>
                            )}
                            <button className="icon-button" onClick={toggleTheme} aria-label="Toggle theme">
                                {theme === 'light' ? <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg> : <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>}
                            </button>
                        </div>
                    </div>

                    {notification.message && <div className={`notification ${notification.type}`}>{notification.message}</div>}
                    
                    {userAddress ? (
                        <FarmTracker userAddress={userAddress} showNotification={showNotification}/>
                    ) : (
                        <div style={{ textAlign: 'center', padding: '2rem' }}>
                            <p>Please connect your wallet to manage your airdrop checklist.</p>
                        </div>
                    )}

                    {isModalOpen && <ConnectModal onClose={() => setIsModalOpen(false)} onConnect={handleConnect} onFarcasterConnect={handleFarcasterConnect} />}
                </div>
            );
        }

        const ConnectModal = ({ onClose, onConnect, onFarcasterConnect }) => (
            <div className="modal-backdrop">
                <div className="modal-content">
                    <button className="modal-close" onClick={onClose}>&times;</button>
                    <h2>Connect Wallet</h2>
                    <div className="wallet-options">
                         <button className="wallet-button" onClick={() => onConnect(window.ethereum)}>
                            <svg width="24" height="24" viewBox="0 0 256 256"><path fill="#F6851B" d="M127.994 255.345c-2.73 0-5.46-.39-8.086-1.18l-52.01-15.82c-5.85-1.78-9.88-7.25-9.88-13.43V84.085c0-5.85 3.52-11.12 8.9-13.22l8.9-3.41c1.88-.72 3.96-.72 5.85 0l8.9 3.41c5.38 2.1 8.9 7.37 8.9 13.22v47.22c0 2.83-2.3 5.13-5.13 5.13s-5.13-2.3-5.13-5.13V93.36c0-1.07-.68-2.03-1.68-2.42l-6.38-2.45c-.35-.13-.73-.13-1.08 0l-6.38 2.45c-1 .38-1.68 1.35-1.68 2.42v57.8c0 1.28.88 2.37 2.13 2.65l49.49 15.05c2.47.75 5.1-.2 6.7-2.34l34.02-45.74c1.84-2.48 1.4-5.96-.98-7.8l-12.06-9.15c-1.28-.97-3.03-.97-4.31 0l-12.06 9.15c-2.38 1.84-5.86 1.4-7.8-.98l-13.62-18.32c-1.57-2.1-1.1-5.1.95-6.7l34.5-26.08c1.68-1.27 3.9-1.27 5.58 0l34.5 26.08c2.05 1.57 2.5 4.57.95 6.7l-13.62 18.32c-1.94 2.38-5.42 2.78-7.8.98l-12.06-9.15c-1.28-.97-3.03-.97-4.31 0l-12.06 9.15c-2.38 1.84-2.8 5.32-.98 7.8l34.02 45.74c1.6 2.14 4.23 3.09 6.7 2.34l49.49-15.05c1.25-.28 2.13-1.37 2.13-2.65V84.085c0-1.07-.68-2.03-1.68-2.42l-6.38-2.45c-.35-.13-.73-.13-1.08 0l-6.38 2.45c-1 .38-1.68 1.35-1.68 2.42v47.22c0 2.83-2.3 5.13-5.13 5.13s-5.13-2.3-5.13-5.13V93.36c0-5.85 3.52-11.12 8.9-13.22l8.9-3.41c1.88-.72 3.96-.72 5.85 0l8.9 3.41c5.38 2.1 8.9 7.37 8.9 13.22v142.63c0 6.18-4.03 11.65-9.88 13.43l-52.01 15.82c-2.62.8-5.35 1.18-8.086 1.18zM127.994 135.535l25.85-34.75l25.85 34.75l-25.85 19.55l-25.85-19.55z"/></svg>
                            <span>MetaMask</span>
                        </button>
                         <button className="wallet-button" onClick={() => onConnect(window.coinbaseWalletExtension || window.ethereum)}>
                           <svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M12 24C18.6274 24 24 18.6274 24 12C24 5.37258 18.6274 0 12 0C5.37258 0 0 5.37258 0 12C0 18.6274 5.37258 24 12 24Z" fill="#0052FF"></path><path d="M7 7H17V17H7V7Z" fill="white"></path></svg>
                            <span>Coinbase Wallet</span>
                        </button>
                        <button className="wallet-button" onClick={onFarcasterConnect}>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM9.37525 15.0345V15.0457C9.37525 15.6591 8.87539 16.159 8.26194 16.159C7.64849 16.159 7.14863 15.6591 7.14863 15.0457V8.95426C7.14863 8.34081 7.64849 7.84094 8.26194 7.84094C8.87539 7.84094 9.37525 8.34081 9.37525 8.95426V15.0345ZM16.8514 11.7727V11.7839C16.8514 12.3973 16.3515 12.8972 15.7381 12.8972C15.1246 12.8972 14.6248 12.3973 14.6248 11.7839V8.95426C14.6248 8.34081 15.1246 7.84094 15.7381 7.84094C16.3515 7.84094 16.8514 8.34081 16.8514 8.95426V11.7727Z" fill="#8A63D2"></path></svg>
                            <span>Sign in with Farcaster</span>
                        </button>
                    </div>
                </div>
            </div>
        );

        function FarmTracker({ userAddress, showNotification }) {
             // Component logic remains the same...
        }

        function ProjectCard({ project, setProjects, allProjects }) {
            // Component logic remains the same...
        }
        
        // Final render call remains the same...
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>

